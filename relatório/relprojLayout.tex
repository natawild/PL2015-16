%
% Layout retirado de http://www.di.uminho.pt/~prh/curplc09.html#notas
%
\documentclass{report}
\usepackage[portuges]{babel}
%\usepackage[utf8]{inputenc}
\usepackage[latin1]{inputenc}
\usepackage{graphicx}

\usepackage{url}
%\usepackage{alltt}
%\usepackage{fancyvrb}
\usepackage{listings}
%LISTING - GENERAL
\lstset{
	basicstyle=\small,
	numbers=left,
	numberstyle=\tiny,
	numbersep=5pt,
	breaklines=true,
    frame=tB,
	mathescape=true,
	escapeinside={(*@}{@*)}
}
%
%\lstset{ %
%	language=Java,							% choose the language of the code
%	basicstyle=\ttfamily\footnotesize,		% the size of the fonts that are used for the code
%	keywordstyle=\bfseries,					% set the keyword style
%	%numbers=left,							% where to put the line-numbers
%	numberstyle=\scriptsize,				% the size of the fonts that are used for the line-numbers
%	stepnumber=2,							% the step between two line-numbers. If it's 1 each line
%											% will be numbered
%	numbersep=5pt,							% how far the line-numbers are from the code
%	backgroundcolor=\color{white},			% choose the background color. You must add \usepackage{color}
%	showspaces=false,						% show spaces adding particular underscores
%	showstringspaces=false,					% underline spaces within strings
%	showtabs=false,							% show tabs within strings adding particular underscores
%	frame=none,								% adds a frame around the code
%	%abovecaptionskip=-.8em,
%	%belowcaptionskip=.7em,
%	tabsize=2,								% sets default tabsize to 2 spaces
%	captionpos=b,							% sets the caption-position to bottom
%	breaklines=true,						% sets automatic line breaking
%	breakatwhitespace=false,				% sets if automatic breaks should only happen at whitespace
%	title=\lstname,							% show the filename of files included with \lstinputlisting;
%											% also try caption instead of title
%	escapeinside={\%*}{*)},					% if you want to add a comment within your code
%	morekeywords={*,...}					% if you want to add more keywords to the set
%}

\usepackage{xspace}

\parindent=0pt
\parskip=2pt

\setlength{\oddsidemargin}{-1cm}
\setlength{\textwidth}{18cm}
\setlength{\headsep}{-1cm}
\setlength{\textheight}{23cm}

\def\darius{\textsf{Darius}\xspace}
\def\java{\texttt{Java}\xspace}
\def\pe{\emph{Publicação Eletrónica}\xspace}

%%%%\input{LPgeneralDefintions}

\title{Processamento de linguagens  (3º ano de MIEI)\\ \textbf{Trabalho Prático 1}\\ Relatório de Desenvolvimento}
\author{Célia Figueiredo\\ (a67637) \and Diogo Tavares\\ (a61044)\\  \and Gil Gonçalves \\ (a67738) }
\date{\today}

\begin{document}

\maketitle

\begin{abstract}
	
Neste relatório será apresentado o desenvolvimento de um filtro de texto com a posterior aplicação sob um ficheiro BibTex, pretende-se que seja produzido um normalizador de ficheiros BibTex. 

Implementou-se um filtro que permite fazer a contagem das categorias das referências bibliográficas, também foi implementado um filtro que permite a troca para chavetas do campo que está entre aspas. E ainda foi implementado um filtro que coloca os nomes dos autores escritos no formato "N. Apelido". Por fim, de modo a tornar a leitura mais fácil implementou-se um ferramenta de \textit{pretty-printing}. 

Será também mostrado um grafo que ilustra para um dado autor (escolhido pelo utilizador) todos os autores que publicam normalmente com o autor em causa. Utilizou-se a linguagem \textit{Dot} do \textit{ GraphViz} esta, que gerou um ficheiro com um grafo de modo a que posteriormente fosse usada uma das ferramentas que processam \textit{Dot} para desenhar o dito grafo de associações de autores.

\end{abstract}

\tableofcontents

\chapter{Introdução} \label{intro}

Este trabalho envolverá o desenvolvimento de um normalizador de ficheiros \textit{BibTex}, este é o tema do problema 2.2 do enunciado fornecido. 
\begin{description}
  \item [Enquadramento] Utilização de expressões regulares e filtros de texto com o objetivo de produzir novos documentos a partir de padrões existentes no ficheiro de input. 
  \item [Conteúdo do documento] O presente documento contém a explicação do problema, assim como a apresentação das soluções produzidas. 
  \item [Resultados] Os resultados deste desafio serão as alineas pedidas, sendo que serão apresentados em ficheitos \textit{.html} e grafos. 
\end{description}


\section*{Estrutura do Relatório} \
Este documentos está dividido em seis partes 
No capítulo \ref{ae} faz-se uma análise detalhada do problema proposto
de modo a poder-se especificar  as entradas, resultados e formas de transformação do ficheiro \textit{.bib}. 

No capítulo \ref{cdres} serão descritas as estruturas de dados implementadas para a realização do problema descrito. 
No capítulo \ref{codtestes} serão mostradas as expressões regulares desenvolvidas para a implementação do caso de estudo, assim como os testes realizados e os resultados. 
No capítulo~\ref{concl} termina-se o relatório com uma síntese do que foi dito,
as conclusões e o trabalho futuro. No fim do documento estará incluido ficheiros anexos com o código desenvolvido. 

\chapter{Análise e Especificação} \label{ae}
\section{Descrição informal do problema}

O problema escolhido consiste na análise da ferramenta de formatação de citações e referências bibliográficas em documentos \LaTeX. 

O \textit{BibTex} é uma ferramenta que foi criada em  1985 e utiliza um ficheiro \textit{(.bib)} este que é uma base de dados que contém os dados bibliográficos (autor, título, ano de publicação, etc.) das fontes citadas no documento \LaTeX. 

Deixámos um exemplo de um excerto de um ficheiro com a extensão \textit{.bib}: 

\begin{verbatim}
@inbook{Val90a,
author = "Jos\'e M. Valen\c{c}a",
title = "Processos, {O}bjectos e {C}omunica\c{c}\~ao
({O}p\c{c}\~ao I - {MCC})",
chapter = 2,
year = 1990,
month = Oct,
publisher = gdcc,
address = um,
annote = "programacao oobjectos, proc comunicantes, espec formal"
}
\end{verbatim}

O ficheiro BibTex contém várias categorias de referência estas inicializadas sempre pelo caracter $@$, deixamos aqui alguns exemplos de entradas que podem ser encontradas no ficheiro BibTex: 

\begin{verbatim}
@inbook
@misc
@incollection
@inproceedings
@techreport
@unpublished
\end{verbatim}

\section{Especificação do Requisitos}
\subsection{Dados}
Os dados fornecidos são um ficheiro \textit{.bib}, este que é um ficheiro com as caracteristicas de um ficheiro \textit{BibTex}. 

Cada tipo de categoria tem os seus campos obrigatórios, neste acaso o objetivo de uma das tarefas será pesquisar através do campo \textbf{author = } o nome do autor e transformá-lo no formato "N. Apelido". 

O nome da categoria é seguida por uma chaveta, e o primeiro campo será o nome para a referência a ser introduzida, os campos de cada categoria são separados por vírgula e a seguir ao campo aparecerá o simbolo igual (=), deixámos um exemplo da sintaxe da categoria \textbf{$@$phdthesis} e os respetivos campos presentes: 

\begin{verbatim}
@phdthesis{Mos75a,
author = "P. D. Mosses",
title = "Mathematical Semantics and Compiler Generation",
year = 1975,
school = "Oxford University",
annote = "compilacao incremental, atributos, ambientes prog"
}
\end{verbatim}

É também fornecido o nome de ferramentas de apoio à resolução do problema, neste caso o \textit{Graph Viz}, que permitirá colocar gráficamente a informação dos grafos criados, sendo que tornará as iterações entre os autores mais percetiveis. 


\begin{figure}[<+htpb+>]
	\centering
	\includegraphics[scale=0.5]{grafoex}
	\caption{Exemplo de geração de um grafo com os nomes dos autores com recurso à ferramenta \textit{Graph Viz} }
	\label{p1:fig:ae}
\end{figure}


\chapter{Concepção/desenho da Resolução} \label{cdres}
\section{Estruturas de Dados}

Será necessário utilizar listas ligadas 

\subsection{Algoritmo alinea a)}

Nesta alinea optou-se por utilizar listas ligadas porque o nosso objetivo é armazenar as categorias das referências do \textit{BibTex}, estas que são strings e o objetivo é contá-las o que nos tornou a tarefa mais simples. 

\begin{verbatim}
void* procura(char* c){
int flag = 1;

Est* aux;
aux = est;
while(aux!=NULL && flag && aux->cat != NULL){
if(!strcmp(minusculas(aux->cat), minusculas(c+1))){				
aux->i++;
flag=0;
}
aux=aux->next;
}				

if(flag){
Est* novo = (Est*) malloc(sizeof(Est));
novo->cat = strdup(c+1);
novo->i = 1;
novo->next = est;
est = novo;
}
}
\end{verbatim}

\subsection{Algoritmo alinea b)}




\subsection{Algoritmo alinea c)}



\chapter{Codificação e Testes} \label{codtestes}

\section{Alternativas, Decisões e Problemas de Implementação}

\subsection{Expressões Regulares}
Para garantir que uma secção do código do ficheiro input ficassse protegida de todas as acções accionadas por outras expressões regulares declaramos o estado \%x. 

\subsubsection{Alinea a)}

Nesta alinea é pedido que se faça a contagem das categorias existentes, e no final se produza um ficheiro em formato HTML como o nome e as respetivas contagens. 

Para a realização deste desafio é necesário procurar a categoria inicializada pelo caractere $@$ até encontrar a chaveta de abertura (\{). A categoria encontrada será inserida na estrutura através da função \textit{procura}, se a categoria já existir adiciona mais uma entrada ao contador, senão cria uma nova e insere-a na estrutura. Todas as categorias que obdecerem à expressão regular são capturadas com o \textit{yytext}. 

\begin{verbatim}
@[^{]*	{procura(yytext);}
\end{verbatim}

O restante texto é ignorado com a seguinte expressão: 
\begin{verbatim}
.|\n	{;}
\end{verbatim}

\subsubsection{Alínea b1)}
Esta alínea está dividida em duas partes. A primeira pede que sempre que um campo está entre aspas estas sejam trocadas por chavetas e o nome dos autores deverá apresentar o formato "N. Apelido". 




\begin{verbatim}

"author ="[ ]+"\""  {BEGIN (AUT);} 
"author ="[ ]+"\{"  {BEGIN (AUT);} 


<AUT>"\}"  {inser(yytext); }
<AUT>"\""  {inser(yytext); }
<AUT>"\,"[ ]+  {trata();funcao();} 
<AUT>[ ]+"and"[ ]+  {trata();funcao();}
<AUT>[ ]+"and"(\n)  {trata();funcao();}
<AUT>"\"""\,"     {trata();funcao();print();tmp=NULL;BEGIN INITIAL;}
<AUT>"\}""\,"     {trata();funcao();print();tmp=NULL;BEGIN INITIAL;}
<AUT>[ '-}] {inser(yytext); }  

\"[a-zA-Z] 	{printf("{%c", yytext[1]);}
[a-zA-Z]\" 	{printf("%c}", yytext[0]);}
\end{verbatim}

\subsubsection{Alínea c)}

Nesta alínea é pedido que seja construido um grafo que mostre para dado autor todos os autores que publicam com ele. 

Para tal é necessário que seja feita a recolha de todos os nomes dos autores, depois para associá-los utiliza-se a expressão \textit{and} que nos indica quais os autores que teem publicações conjuntas. 

\begin{verbatim}
"author ="[ ]*"\""  {BEGIN (AUT);} 
"author ="[ ]*"\{"  {BEGIN (AUT);} 
<AUT>"\}"             {;}
<AUT>"\,"[ ]+         {trata();}
<AUT>[ ]+"and"[ ]+    {trata();}
<AUT>[ ]+"and"(\n)    {trata();}
<AUT>"\"""\,"         {trata();print();tmp=NULL;BEGIN INITIAL;}
<AUT>"\}""\,"         {trata();print();tmp=NULL;BEGIN INITIAL;}
<AUT>[A-Za-z]           {inser(yytext);}
\end{verbatim}


\subsection{Makefile}


\section{Testes realizados e Resultados}
Mostram-se a seguir alguns testes feitos (valores introduzidos) e
os respectivos resultados obtidos:
\subsection{Testes e Resultados alinea a)}

Utilizámos este ficheiro de teste para testar as diferentes opções que apareciam no ficheiro  

\lstinputlisting{teste.bib}


Mostrámos de seguida o ficheiro \textit{.html} produzido: 
\begin{verbatim}
proceeding -> 1
mastersthesis -> 2
proceedings -> 4
misc -> 61
manual -> 13
incollection -> 6
unpublished -> 15
inproceedings -> 209
article -> 142
phdthesis -> 21
book -> 47
inbook -> 3
techreport -> 140
string -> 31
\end{verbatim}

\subsection{Testes e Resultados alinea b)}

\subsection{Testes e Resultados alinea c)}


\chapter{Conclusão} \label{concl}
Síntese do Documento.\\
Estado final do projecto; Análise crítica dos resultados.\\
Trabalho futuro.

\appendix
\chapter{Código do Programa}

Lista-se a seguir o código que foi desenvolvido para a alínea a: 

\lstinputlisting{ex1.l}


Lista-se a seguir o código que foi desenvolvido para a alínea b: 

\lstinputlisting{exb.l}

Lista-se a seguir o código que foi desenvolvido para a alínea c: 

\lstinputlisting{grafo.l}


\begin{lstlisting}[caption={Exemplo de uma Listagem}, label={lstExe1}]
llll sanjdb c kjnjcnjnjj mmmmmmmmmmmmm hhhhhhhhhhhhhhhhhhhhhhhh jjjjjjjjjjjjjjjjjjjjjjjjjjjj kkkkkkkkkkkkkkkkkk
      ou então aparecer aqui neste sítio um pouco de matematica $\$$
      como alternativa ao anterior. 
      e aqui mais um teste $\varepsilon$
\end{lstlisting}


\bibliographystyle{alpha}
\bibliography{../Bibs/lp,prh}















\end{document} 